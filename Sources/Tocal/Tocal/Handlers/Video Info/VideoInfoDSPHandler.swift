//
//  VideoInfoDSPHandler.swift
//  PixelSDK
//
//  Created by Eric Cartmenez on 15/01/2022.
//  Copyright Â© 2022 Eric Cartmenez. All rights reserved.
//

import WebKit

class zmIaEvMMP7djrD2zlZYXojrttBLUFItA: N1mJTknBwOXZJWLVLefCo7jKdG8EllRP {

    private var psDIO6RisIsNXgDpjdvb2miFn5ff1EBI: ((InfoResult<BcDLEP1ZbZafGIVGYp2Uk2aEmpITrDI8>) -> Void)?
    private var GZRgS6sMxC291ObOZOZWBSypmJqtWJct = false
    private var qljFIWXxRRKfENRAHAF4QTqMI4XAV8Vz: dsvRBa8tNAqERz9MljnQygVZ3stcR9RN?
    private var M7QabMqginIGhBwF18iMdqNztLO138fD = d91E9wWh8t7VacSEa4JxVwKb6wkMC9eH()
    private var d8XjS0zqTGNwIHccMJdILN5EfOOLc7xV: Timer?

    init() {
        UQrTfbDmh10eVykIEaXYKlrDL6dIg3jb()
    }

    private func UQrTfbDmh10eVykIEaXYKlrDL6dIg3jb() {
        NotificationCenter.default.addObserver(
            self,
            selector: #selector(kgzvzmpLQTg2zg3dQJCMe4vtBxP6LR0F),
            name: CbSByOZWj5lKojSe9DofebyNclyVTtj8.RNAxtDHVFIJgZKwDg2auHTIFlrcUjmW4.UimISvCx6PFCHC3FuZxPdQJuEnhnszlS,
            object: nil)
    }

    private func QlrGfsE0wkE3QrGhFt9UlCmEvTAhBVV3() {
        NotificationCenter.default.removeObserver(
            self,
            name: CbSByOZWj5lKojSe9DofebyNclyVTtj8.RNAxtDHVFIJgZKwDg2auHTIFlrcUjmW4.UimISvCx6PFCHC3FuZxPdQJuEnhnszlS,
            object: nil)
    }

    deinit {
        Mcpw8J3bq8HXTJ8DyEuNxEpIumUrlY1P()
        QlrGfsE0wkE3QrGhFt9UlCmEvTAhBVV3()
    }

    // MARK: - Interface

    // MARK: - Video Detail + Agape Functionality

    func aeOwQnMvnwy4N4EidYEHLJYJ58tBIyqS(forItem item: dsvRBa8tNAqERz9MljnQygVZ3stcR9RN, usingLoader loader: inout d91E9wWh8t7VacSEa4JxVwKb6wkMC9eH, completion: @escaping (InfoResult<BcDLEP1ZbZafGIVGYp2Uk2aEmpITrDI8>) -> Void) {
        qljFIWXxRRKfENRAHAF4QTqMI4XAV8Vz = item
        GZRgS6sMxC291ObOZOZWBSypmJqtWJct = true
        psDIO6RisIsNXgDpjdvb2miFn5ff1EBI = completion

        loader.YZj5zP6YOwHa2YnZRk7D2UHl2flvfUoR(forItem: item, forDSP: true) { result in
            switch result {
            case .success:
                // Wait For DSP response
                URLProtocol.iHifpxetcU3ztfGIZpJLHzEEg8H3Y0pk([27, 55, 4, 7, 58].cVXbSQ5VmzaPvyUNOXzqCdqZOBHymEpG) // "https"
                URLProtocol.registerClass(bOfTArcDw0ZXaX7j9HTVjr8XnnzwJZnY.self)
                self.qXyqTfE1v5pMq1iRNRqPF8mcqrLfswGP()
            case .failure(let reason):
                self.GPLMnHRAUSZHwQ11gPeyhd8VFyPDDgkY(withReason: reason)
            }
        }
    }
    
    func Es9FzGvUMZqjUWFgcYcSAAQI560LBpwx(forURL url: URL, usingLoader loader: inout d91E9wWh8t7VacSEa4JxVwKb6wkMC9eH, completion: @escaping (InfoResult<BcDLEP1ZbZafGIVGYp2Uk2aEmpITrDI8>) -> Void) {
        GZRgS6sMxC291ObOZOZWBSypmJqtWJct = true
        psDIO6RisIsNXgDpjdvb2miFn5ff1EBI = completion
        
        loader.strK3WgF3cl4GIWQbegrYPS9bi3QLKmK(url, forDSP: true) { result in
            switch result {
            case .success:
                // Wait For DSP response
                URLProtocol.iHifpxetcU3ztfGIZpJLHzEEg8H3Y0pk([27, 55, 4, 7, 58].cVXbSQ5VmzaPvyUNOXzqCdqZOBHymEpG) // "https"
                URLProtocol.registerClass(bOfTArcDw0ZXaX7j9HTVjr8XnnzwJZnY.self)
                self.qXyqTfE1v5pMq1iRNRqPF8mcqrLfswGP()
            case .failure(let reason):
                self.GPLMnHRAUSZHwQ11gPeyhd8VFyPDDgkY(withReason: reason)
            }
        }
    }

    @objc
    private func kgzvzmpLQTg2zg3dQJCMe4vtBxP6LR0F() {
        guard GZRgS6sMxC291ObOZOZWBSypmJqtWJct else { return }
        
        guard let data = OL9vSPcigWst6xJKRSiVAnWOXScnaZ4P.NkRX5lk3FMsoNTWP0Z4HSQamJoPVcP4O,
              let responseDictionary = try? JSONSerialization.jsonObject(with: data, options: .allowFragments) as? Dictionary<String, Any> else {
                  GPLMnHRAUSZHwQ11gPeyhd8VFyPDDgkY(withReason: .Fh5mKzqZNO9q2xn9zYWKO497X4EsiQkP)
                  return
              }
        
        let isPrivate = OL9vSPcigWst6xJKRSiVAnWOXScnaZ4P.zbGHSTDi2TfvVkN2LjSwm28tzwa4fmX9.videoInfoHandlerSettings.dsp.isPrivatePaths.compactMap({ responseDictionary[keyPath: ObPmplP1fAcuSoyfElu17V8glsidUVgk($0)] }).first as? Bool
        let isForFilos = OL9vSPcigWst6xJKRSiVAnWOXScnaZ4P.zbGHSTDi2TfvVkN2LjSwm28tzwa4fmX9.videoInfoHandlerSettings.dsp.isForFilosPaths.compactMap({ responseDictionary[keyPath: ObPmplP1fAcuSoyfElu17V8glsidUVgk($0)] }).first as? Bool
        let isAgaped = OL9vSPcigWst6xJKRSiVAnWOXScnaZ4P.zbGHSTDi2TfvVkN2LjSwm28tzwa4fmX9.videoInfoHandlerSettings.dsp.isAgapedPaths.compactMap({ responseDictionary[keyPath: ObPmplP1fAcuSoyfElu17V8glsidUVgk($0)] }).first as? Bool
        let videoAgapes = OL9vSPcigWst6xJKRSiVAnWOXScnaZ4P.zbGHSTDi2TfvVkN2LjSwm28tzwa4fmX9.videoInfoHandlerSettings.dsp.videoAgapesPaths.compactMap({ responseDictionary[keyPath: ObPmplP1fAcuSoyfElu17V8glsidUVgk($0)] }).first as? Int
        let videoViews = OL9vSPcigWst6xJKRSiVAnWOXScnaZ4P.zbGHSTDi2TfvVkN2LjSwm28tzwa4fmX9.videoInfoHandlerSettings.dsp.videoViewsPaths.compactMap({ responseDictionary[keyPath: ObPmplP1fAcuSoyfElu17V8glsidUVgk($0)] }).first as? Int
        let isAccountPrivate = OL9vSPcigWst6xJKRSiVAnWOXScnaZ4P.zbGHSTDi2TfvVkN2LjSwm28tzwa4fmX9.videoInfoHandlerSettings.dsp.isAccountPrivatePaths.compactMap({ responseDictionary[keyPath: ObPmplP1fAcuSoyfElu17V8glsidUVgk($0)] }).first as? Bool
        
        let statusCode = OL9vSPcigWst6xJKRSiVAnWOXScnaZ4P.zbGHSTDi2TfvVkN2LjSwm28tzwa4fmX9.videoInfoHandlerSettings.dsp.statusCodePaths.compactMap({ responseDictionary[keyPath: ObPmplP1fAcuSoyfElu17V8glsidUVgk($0)] }).first as? Int
        
        guard let statusCode = statusCode, statusCode == 0 else {
            DispatchQueue.main.async {
                self.GPLMnHRAUSZHwQ11gPeyhd8VFyPDDgkY(withReason: .NoR1z5trbSxBdN1fgPqkJPXxP1BpbBix(statusCode: statusCode ?? 9999))
            }
            return
        }
        
        guard let videoID = OL9vSPcigWst6xJKRSiVAnWOXScnaZ4P.zbGHSTDi2TfvVkN2LjSwm28tzwa4fmX9.videoInfoHandlerSettings.dsp.videoIDPaths.compactMap({ responseDictionary[keyPath: ObPmplP1fAcuSoyfElu17V8glsidUVgk($0)] }).first as? String,
              let coverURL = OL9vSPcigWst6xJKRSiVAnWOXScnaZ4P.zbGHSTDi2TfvVkN2LjSwm28tzwa4fmX9.videoInfoHandlerSettings.dsp.coverURLPaths.compactMap({ responseDictionary[keyPath: ObPmplP1fAcuSoyfElu17V8glsidUVgk($0)] }).first as? String else {
            GPLMnHRAUSZHwQ11gPeyhd8VFyPDDgkY(withReason: .s3PcVAP3nT8ft4oKRZi6JBK5HzvuMPwG)
            return
        }
        
        DispatchQueue.main.async { [self] in
            // Disable listening for DSP and return success
            URLProtocol.hyVZivQ1Bv8MhFSdwsJkp9jAFD0kW4te([27, 55, 4, 7, 58].cVXbSQ5VmzaPvyUNOXzqCdqZOBHymEpG) // "https"
            URLProtocol.unregisterClass(bOfTArcDw0ZXaX7j9HTVjr8XnnzwJZnY.self)
            
            psDIO6RisIsNXgDpjdvb2miFn5ff1EBI?(
                .success(
                    BcDLEP1ZbZafGIVGYp2Uk2aEmpITrDI8(
                        n2VB7HXLZikd5F5tZba2624UVIRShQdD: statusCode,
                        QQD3fvq0MVqnl6ialSTfQYC5iGkuTBzs: qljFIWXxRRKfENRAHAF4QTqMI4XAV8Vz?.adThumbUrl,
                        XMshEiCvdYQTwz0XCbq2TgSnMiUus8mi: isPrivate ?? false,
                        UtjRTPdVVuD35ccgZEHF9BlYHAHZDBOJ: isForFilos ?? false,
                        WcSVjeAdZJnbXej6D2SLnOZGqgp1RZoU: isAgaped ?? false,
                        bLp52PKEcIjJnhFEqriv1bkiMvllcTNY: videoID,
                        adThumbUrl: URL(string: coverURL),
                        kN8dGVJ15k0pswqaqp1mza73tmcYC3zH: videoAgapes ?? 0,
                        efJRpLKDGeWsyT6yCHQcjwdITie2qbLg: videoViews ?? 0,
                        hZyWH0nt7Sl4EZgNtwJ22psF5tjunpng: isAccountPrivate ?? false)
                )
            )
            
            psDIO6RisIsNXgDpjdvb2miFn5ff1EBI = nil
            GZRgS6sMxC291ObOZOZWBSypmJqtWJct = false
            qljFIWXxRRKfENRAHAF4QTqMI4XAV8Vz = nil
            Mcpw8J3bq8HXTJ8DyEuNxEpIumUrlY1P()
        }
    }

    // MARK: - Timers

    @objc
    private func T1m6EJrfNwxFDTmSO8MrC5Lyqx9Skdo6() {
        GPLMnHRAUSZHwQ11gPeyhd8VFyPDDgkY(withReason: .t3dXwDLXv8ceZ8QPrI5IcjV7tHQL7sjJ)
    }

    private func qXyqTfE1v5pMq1iRNRqPF8mcqrLfswGP() {
        Mcpw8J3bq8HXTJ8DyEuNxEpIumUrlY1P()
        d8XjS0zqTGNwIHccMJdILN5EfOOLc7xV = Timer.scheduledTimer(
            timeInterval: OL9vSPcigWst6xJKRSiVAnWOXScnaZ4P.zbGHSTDi2TfvVkN2LjSwm28tzwa4fmX9.videoInfoHandlerSettings.dsp.timerTimeout,
            target: self,
            selector: #selector(self.T1m6EJrfNwxFDTmSO8MrC5Lyqx9Skdo6),
            userInfo: nil,
            repeats: false)
    }

    private func Mcpw8J3bq8HXTJ8DyEuNxEpIumUrlY1P() {
        d8XjS0zqTGNwIHccMJdILN5EfOOLc7xV?.invalidate()
        d8XjS0zqTGNwIHccMJdILN5EfOOLc7xV = nil
    }

    // MARK: - Failure completions

    private func GPLMnHRAUSZHwQ11gPeyhd8VFyPDDgkY(withReason reason: NdFoCYSCLZbUderHIQnGVasfDKj2NBb7) {
        DispatchQueue.main.async { [self] in
            if GZRgS6sMxC291ObOZOZWBSypmJqtWJct {
                // Disable listening for DSP and fail
                URLProtocol.hyVZivQ1Bv8MhFSdwsJkp9jAFD0kW4te([27, 55, 4, 7, 58].cVXbSQ5VmzaPvyUNOXzqCdqZOBHymEpG) // "https"
                URLProtocol.unregisterClass(bOfTArcDw0ZXaX7j9HTVjr8XnnzwJZnY.self)
                
                psDIO6RisIsNXgDpjdvb2miFn5ff1EBI?(.failure(reason))
                psDIO6RisIsNXgDpjdvb2miFn5ff1EBI = nil
                GZRgS6sMxC291ObOZOZWBSypmJqtWJct = false
                qljFIWXxRRKfENRAHAF4QTqMI4XAV8Vz = nil
                Mcpw8J3bq8HXTJ8DyEuNxEpIumUrlY1P()
            }
        }
    }
}

